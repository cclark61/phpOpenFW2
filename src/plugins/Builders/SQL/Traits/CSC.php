<?php
//*****************************************************************************
//*****************************************************************************
/**
 * SQL Comma Separated Clause Trait
 *
 * @package         phpOpenFW
 * @author          Christian J. Clark
 * @copyright       Copyright (c) Christian J. Clark
 * @license         https://mit-license.org
 **/
//*****************************************************************************
//*****************************************************************************

namespace phpOpenFW\Builders\SQL\Traits;

//*****************************************************************************
/**
 * CSC Trait
 */
//*****************************************************************************
trait CSC
{
    //=========================================================================
    //=========================================================================
    // Add Item Raw Method
    //=========================================================================
    //=========================================================================
    protected static function AddItem(&$var, $val)
    {
        if ($val) {
            if (is_array($val)) {
                $var = array_merge($var, $val);
            }
            else {
                $var[] = $val;
            }
        }
    }

    //=========================================================================
    //=========================================================================
    // Add Item CSC Method
    //=========================================================================
    // Detects comma separated items and pulls them apart
    // and adds them individually
    //=========================================================================
    //=========================================================================
    protected static function AddItemCSC(&$var, $value)
    {
        if ($value) {
            $values = [];

            //-----------------------------------------------------------------
            // Scalar Value
            //-----------------------------------------------------------------
            if (is_scalar($value)) {
                $values = explode(',', $value);
            }
            //-----------------------------------------------------------------
            // Array of Values
            //-----------------------------------------------------------------
            else if (is_array($value)) {
                foreach ($value as $tmp_value) {
                    $tmp_value = trim($tmp_value);
                    if ($tmp_value) {
                        self::AddItemCSC($var, $tmp_value);
                    }
                }
                return true;
            }

            //-----------------------------------------------------------------
            // Scalar value exploded by comma into an array
            //-----------------------------------------------------------------
            if ($values && is_iterable($values)) {
                foreach ($values as $tmp_value) {
                    $tmp_value = trim($tmp_value);
                    if ($tmp_value) {
                        self::AddItem($var, $tmp_value);
                    }
                }
            }
        }

        return true;
    }

    //=========================================================================
    //=========================================================================
    // Format Comma Separated Clause Method
    //=========================================================================
    //=========================================================================
    protected static function FormatCSC($clause, $values)
    {
        if ($values) {
            return "{$clause}\n  " . implode(",\n  ", $values);
        }

        return false;
    }

}
